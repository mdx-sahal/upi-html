<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPI Payment Demo - Test Mode</title>
    <style>
        /* Previous CSS remains the same, adding new styles */
        .test-mode {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .amount-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .amount-option {
            padding: 8px 15px;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .amount-option.selected {
            border-color: #007bff;
            background: #007bff;
            color: white;
        }
        
        .debug-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 0.8em;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõçÔ∏è Demo Store</h1>
            <p>UPI Payment Test Mode</p>
        </div>

        <div class="test-mode">
            <strong>Test Mode Active</strong>
            <p>Using test UPI IDs to avoid bank limits</p>
        </div>

        <div class="order-summary">
            <h3>Order Summary</h3>
            <div class="order-item">
                <span>Demo Product</span>
                <span id="displayAmount">‚Çπ1.00</span>
            </div>
            <div class="total">
                <span>Total Amount</span>
                <span id="totalAmount">‚Çπ1.00</span>
            </div>
            
            <div class="amount-selector">
                <div class="amount-option selected" data-amount="1.00">‚Çπ1</div>
                <div class="amount-option" data-amount="2.00">‚Çπ2</div>
                <div class="amount-option" data-amount="5.00">‚Çπ5</div>
                <div class="amount-option" data-amount="10.00">‚Çπ10</div>
            </div>
        </div>

        <div class="payment-section">
            <button class="upi-button" onclick="initiateUPIPayment()">
                <span>üí≥</span>
                Test UPI Payment
            </button>
            
            <div class="payment-status" id="paymentStatus"></div>
            
            <button onclick="toggleDebug()" style="margin-top: 10px; background: #6c757d; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                Debug Info
            </button>
            
            <div class="debug-info" id="debugInfo"></div>
        </div>
    </div>

    <script>
        let currentAmount = '1.00';
        let currentTransactionId = '';

        // Test UPI configurations
        const testConfigs = [
            { pa: 'success@razorpay', pn: 'Razorpay Test', type: 'always_success' },
            { pa: 'failure@razorpay', pn: 'Razorpay Test', type: 'always_failure' },
            { pa: 'test@ybl', pn: 'PhonePe Test', type: 'random' },
            { pa: 'test@okicici', pn: 'GPay Test', type: 'random' }
        ];

        // Amount selection
        document.querySelectorAll('.amount-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.amount-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
                
                currentAmount = this.getAttribute('data-amount');
                document.getElementById('displayAmount').textContent = `‚Çπ${currentAmount}`;
                document.getElementById('totalAmount').textContent = `‚Çπ${currentAmount}`;
            });
        });

        function generateTransactionId() {
            return 'TXN' + Date.now() + Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        function getRandomTestConfig() {
            return testConfigs[Math.floor(Math.random() * testConfigs.length)];
        }

        function initiateUPIPayment() {
            currentTransactionId = generateTransactionId();
            const config = getRandomTestConfig();
            
            // Show pending status
            showPaymentStatus('pending', 'Opening UPI app...');
            
            // Construct UPI deep-link
            const upiLink = `upi://pay?pa=${config.pa}&pn=${encodeURIComponent(config.pn)}&am=${currentAmount}&cu=INR&tn=${encodeURIComponent(currentTransactionId)}`;
            
            // Store transaction info
            localStorage.setItem('currentTransaction', currentTransactionId);
            localStorage.setItem('transactionTime', Date.now().toString());
            localStorage.setItem('transactionAmount', currentAmount);
            localStorage.setItem('upiConfig', JSON.stringify(config));

            // Show debug info
            updateDebugInfo(upiLink, config);

            // Open UPI app
            console.log('Opening UPI link:', upiLink);
            window.location.href = upiLink;

            // Start payment verification
            setTimeout(() => {
                simulatePaymentVerification(currentTransactionId, config);
            }, 3000);
        }

        function simulatePaymentVerification(transactionId, config) {
            showPaymentStatus('pending', 'Verifying payment...');

            // Simulate different outcomes based on test config
            setTimeout(() => {
                let status, message;
                
                switch(config.type) {
                    case 'always_success':
                        status = 'success';
                        message = `Payment successful! ‚Çπ${currentAmount} received.`;
                        break;
                    case 'always_failure':
                        status = 'failed';
                        message = 'Payment failed. Please try again.';
                        break;
                    case 'random':
                    default:
                        status = Math.random() > 0.3 ? 'success' : 'failed';
                        message = status === 'success' 
                            ? `Payment successful! ‚Çπ${currentAmount} received.` 
                            : 'Payment failed or was cancelled.';
                        break;
                }
                
                showPaymentStatus(status, message);
                
                // Update debug info with result
                updateDebugInfo(null, config, { status, message });
                
            }, 2000);
        }

        function showPaymentStatus(status, message) {
            const statusDiv = document.getElementById('paymentStatus');
            statusDiv.className = 'payment-status';
            statusDiv.style.display = 'block';

            switch(status) {
                case 'pending':
                    statusDiv.classList.add('status-pending');
                    statusDiv.innerHTML = `<div class="loading"></div> ${message}`;
                    break;
                case 'success':
                    statusDiv.classList.add('status-success');
                    statusDiv.innerHTML = `‚úÖ ${message}`;
                    break;
                case 'failed':
                    statusDiv.classList.add('status-failed');
                    statusDiv.innerHTML = `‚ùå ${message}`;
                    break;
            }
        }

        function toggleDebug() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.style.display = debugInfo.style.display === 'none' ? 'block' : 'none';
        }

        function updateDebugInfo(upiLink = null, config = null, result = null) {
            const debugInfo = document.getElementById('debugInfo');
            let content = '';
            
            if (upiLink && config) {
                content = `
                    <strong>Current Transaction:</strong><br>
                    ID: ${currentTransactionId}<br>
                    Amount: ‚Çπ${currentAmount}<br>
                    UPI ID: ${config.pa}<br>
                    Type: ${config.type}<br>
                    Deep Link: <span style="word-break: break-all;">${upiLink}</span>
                `;
            }
            
            if (result) {
                content += `<br><br><strong>Result:</strong> ${result.status} - ${result.message}`;
            }
            
            debugInfo.innerHTML = content;
        }

        // Handle app return
        window.addEventListener('focus', () => {
            const storedTransaction = localStorage.getItem('currentTransaction');
            const transactionTime = localStorage.getItem('transactionTime');
            
            if (storedTransaction && transactionTime) {
                const timeDiff = Date.now() - parseInt(transactionTime);
                if (timeDiff > 3000) {
                    const config = JSON.parse(localStorage.getItem('upiConfig') || '{}');
                    simulatePaymentVerification(storedTransaction, config);
                }
            }
        });

        // Initialize debug info
        updateDebugInfo();
    </script>
</body>
</html>
